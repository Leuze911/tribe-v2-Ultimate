# TRIBE v2 - E2E Test: Offline Mode & Sync
# Tests creating POI offline and syncing when back online
# NOTE: This test requires device/simulator with airplane mode support
# Prerequisites: User must be logged in

appId: host.exp.Exponent
---

# Test: Create POI in offline mode (Android)
- runFlow:
    when:
      platform: Android
    commands:
      - launchApp

      - assertVisible:
          text: "Rechercher un lieu..."
          timeout: 5000

      # Enable airplane mode (simulate offline)
      - runScript: adb shell cmd connectivity airplane-mode enable

      # Wait for offline detection
      - waitForAnimationToEnd:
          timeout: 3000

      # Create POI while offline
      - tapOn:
          id: "add-poi-button"

      - assertVisible: "Touchez la carte pour placer le POI"

      - tapOn:
          point: "50%,50%"

      - tapOn: "Confirmer"

      - assertVisible: "Nouveau POI"

      - tapOn: "Ex: Cafe de la Paix"
      - inputText: "Offline POI Android"

      - tapOn: "Creer le POI"

      # Should show success (saved locally)
      - assertVisible:
          text: "Succès"
          timeout: 5000

      - tapOn: "OK"

      # Re-enable network
      - runScript: adb shell cmd connectivity airplane-mode disable

      # Wait for sync
      - waitForAnimationToEnd:
          timeout: 10000

      # Verify back on map
      - assertVisible: "Rechercher un lieu..."

# Test: Create POI in offline mode (iOS)
- runFlow:
    when:
      platform: iOS
    commands:
      - launchApp

      - assertVisible:
          text: "Rechercher un lieu..."
          timeout: 5000

      # Note: iOS simulator doesn't support airplane mode via CLI
      # This test verifies the flow but network control is limited

      # Create POI
      - tapOn:
          id: "add-poi-button"

      - assertVisible: "Touchez la carte pour placer le POI"

      - tapOn:
          point: "50%,50%"

      - tapOn: "Confirmer"

      - assertVisible: "Nouveau POI"

      - tapOn: "Ex: Cafe de la Paix"
      - inputText: "POI Test iOS"

      - tapOn: "Creer le POI"

      - assertVisible:
          text: "Succès"
          timeout: 10000

      - tapOn: "OK"

      - assertVisible: "Rechercher un lieu..."
